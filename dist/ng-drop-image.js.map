{"version":3,"file":"ng-drop-image.js","sources":["../index.js"],"sourcesContent":["(function (root, factory) {\r\n  'use strict';\r\n\r\n  if (typeof define === 'function' && define.amd) {\r\n    define(['angular'], factory);\r\n  } else if (typeof exports === 'object') {\r\n    factory(require('angular'));\r\n    module.exports = 'ngDropImage';\r\n  } else {\r\n    // Browser globals (root is window), we don't register it.\r\n    factory(root.angular);\r\n  }\r\n}(window , function (angular) {\r\n    'use strict';\r\n\r\n    var directive = function($q, $localStorage) {\r\n        return {\r\n            require: '^ngModel',\r\n            restrict: 'A',\r\n            scope: { 'ngModel': '=' },\r\n            link: ($scope, $element, $attrs, $ngModel) => {\r\n\r\n                $scope.$storage = $localStorage.$default({\r\n                        image: $scope.ngModel\r\n                });\r\n\r\n                $ngModel.$setViewValue($scope.$storage.image);\r\n\r\n                $($element[0]).on('dragover dragenter dragleave', (e) => {\r\n                        e.preventDefault();\r\n                        e.stopPropagation();\r\n                        return false;\r\n                });\r\n\r\n                $($element[0]).on('drop', e => {\r\n                    e.stopPropagation();\r\n                    e.preventDefault();\r\n\r\n                    var files = e.originalEvent.dataTransfer.files;\r\n\r\n                    if(files.length){\r\n                        readFile(files[0]).then((value) => {\r\n                                $ngModel.$setViewValue(value);\r\n                                storage(value);\r\n                        });\r\n                    } else {\r\n                        var url = e.originalEvent.dataTransfer.getData('url');\r\n                        $ngModel.$setViewValue(url);\r\n                        storage(url);\r\n                    }\r\n\r\n                    $scope.$apply();\r\n\r\n                    return false;\r\n\r\n                })\r\n\r\n                function storage(value){\r\n                    $scope.$storage.image = value;\r\n                };\r\n\r\n                function readFile(file) {\r\n\r\n                    var deferred = $q.defer();\r\n\r\n                    var reader = new FileReader();\r\n\r\n                    reader.onload = event => {\r\n                        deferred.resolve(event.target.result);\r\n                    };\r\n\r\n                    reader.onerror = event => {\r\n                        deferred.reject(e);\r\n                    };\r\n\r\n                    reader.readAsDataURL(file);\r\n\r\n                    return deferred.promise;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    directive.$inject = ['$q', '$localStorage'];\r\n\r\n    angular.module('ngDropImage', ['ngStorage'])\r\n        .config(['$localStorageProvider', s => {\r\n            s.setKeyPrefix('ng-drop-image-');\r\n        }])\r\n        .directive('ngDropImage', directive);\r\n}))\r\n"],"names":["root","factory","define","amd","exports","require","angular","window","directive","$q","$localStorage","$scope","$element","$attrs","$ngModel","$storage","$default","ngModel","$setViewValue","image","on","e","preventDefault","stopPropagation","files","originalEvent","dataTransfer","length","then","value","url","getData","$apply","storage","readFile","file","deferred","defer","reader","FileReader","onload","resolve","event","target","result","onerror","reject","readAsDataURL","promise","$inject","module","config","setKeyPrefix"],"mappings":";;;;;;;;AAAC,WAAUA,IAAV,EAAgBC,OAAhB,EAAyB;;;QAGpB,OAAOC,MAAP,KAAkB,UAAlB,IAAgCA,OAAOC,GAA3C,EAAgD;eACvC,CAAC,SAAD,CAAP,EAAoBF,OAApB;KADF,MAEO,IAAI,QAAOG,OAAP,yCAAOA,OAAP,OAAmB,QAAvB,EAAiC;gBAC9BC,QAAQ,SAAR,CAAR;eACOD,OAAP,GAAiB,aAAjB;KAFK,MAGA;;gBAEGJ,KAAKM,OAAb;;CAVH,EAYCC,MAZD,EAYU,UAAUD,OAAV,EAAmB;;;QAGtBE,YAAY,SAAZA,SAAY,CAASC,EAAT,EAAaC,aAAb,EAA4B;eACjC;qBACM,UADN;sBAEO,GAFP;mBAGI,EAAE,WAAW,GAAb,EAHJ;kBAIG,cAACC,MAAD,EAASC,QAAT,EAAmBC,MAAnB,EAA2BC,QAA3B,EAAwC;;uBAEnCC,QAAP,GAAkBL,cAAcM,QAAd,CAAuB;2BAC1BL,OAAOM;iBADJ,CAAlB;;yBAISC,aAAT,CAAuBP,OAAOI,QAAP,CAAgBI,KAAvC;;kBAEEP,SAAS,CAAT,CAAF,EAAeQ,EAAf,CAAkB,8BAAlB,EAAkD,UAACC,CAAD,EAAO;sBAC/CC,cAAF;sBACEC,eAAF;2BACO,KAAP;iBAHR;;kBAMEX,SAAS,CAAT,CAAF,EAAeQ,EAAf,CAAkB,MAAlB,EAA0B,aAAK;sBACzBG,eAAF;sBACED,cAAF;;wBAEIE,QAAQH,EAAEI,aAAF,CAAgBC,YAAhB,CAA6BF,KAAzC;;wBAEGA,MAAMG,MAAT,EAAgB;iCACHH,MAAM,CAAN,CAAT,EAAmBI,IAAnB,CAAwB,UAACC,KAAD,EAAW;qCAClBX,aAAT,CAAuBW,KAAvB;oCACQA,KAAR;yBAFR;qBADJ,MAKO;4BACCC,MAAMT,EAAEI,aAAF,CAAgBC,YAAhB,CAA6BK,OAA7B,CAAqC,KAArC,CAAV;iCACSb,aAAT,CAAuBY,GAAvB;gCACQA,GAAR;;;2BAGGE,MAAP;;2BAEO,KAAP;iBAnBJ;;yBAuBSC,OAAT,CAAiBJ,KAAjB,EAAuB;2BACZd,QAAP,CAAgBI,KAAhB,GAAwBU,KAAxB;;;yBAGKK,QAAT,CAAkBC,IAAlB,EAAwB;;wBAEhBC,WAAW3B,GAAG4B,KAAH,EAAf;;wBAEIC,SAAS,IAAIC,UAAJ,EAAb;;2BAEOC,MAAP,GAAgB,iBAAS;iCACZC,OAAT,CAAiBC,MAAMC,MAAN,CAAaC,MAA9B;qBADJ;;2BAIOC,OAAP,GAAiB,iBAAS;iCACbC,MAAT,CAAgBzB,CAAhB;qBADJ;;2BAIO0B,aAAP,CAAqBZ,IAArB;;2BAEOC,SAASY,OAAhB;;;SA7DZ;KADJ;;cAoEUC,OAAV,GAAoB,CAAC,IAAD,EAAO,eAAP,CAApB;;YAEQC,MAAR,CAAe,aAAf,EAA8B,CAAC,WAAD,CAA9B,EACKC,MADL,CACY,CAAC,uBAAD,EAA0B,aAAK;UACjCC,YAAF,CAAe,gBAAf;KADI,CADZ,EAIK5C,SAJL,CAIe,aAJf,EAI8BA,SAJ9B;CArFH,CAAD"}